<!DOCTYPE html>
<html>
	<head>
		<title>Profile | Cart Chart</title>
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,800&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,900&display=swap" rel="stylesheet">
		<link href="css/fonts/FontAwesome/css/all.css" rel="stylesheet">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/home.css">
		<link rel="stylesheet" type="text/css" href="css/profile.css">
		<link rel="stylesheet" type="text/css" href="css/icons.css">
		<link rel="stylesheet" type="text/css" href="css/navbar.css">
		<link rel="stylesheet" type="text/css" href="css/calendar.css">
		<link rel="stylesheet" type="text/css" href="css/loader.css">
		<link rel="stylesheet" type="text/css" href="css/controller.css">
		<link rel="stylesheet" type="text/css" href="css/tutorial.css">
		<link rel="stylesheet" type="text/css" href="css/custom_elements.css">
		<link rel="icon" type="image/png" href="favicons/favicon-192x192.png" sizes="192x192">
		<link rel="icon" type="image/png" href="favicons/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="16x16">
		<link rel="icon" type="image/png" href="favicons/favicon-128.png" sizes="128x128">
		<link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png">
		<link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-touch-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="144x144" href="favicons/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-touch-icon-57x57.png">
		<link rel="manifest" href="z_manifest.json">
		<meta name="theme-color" content="#ee9102"/>
		<meta content="width=device-width, initial-scale=1" name="viewport" />
	</head>

	<body>
		<cc-page-loader><cc-circle></cc-circle></cc-page-loader>

		<header>
			<div class="navbar">
				<div class="title_container"><button class="title_bars" onclick="navbar.toggle();"><i class="material-icons">menu</i></button><h2 class="title">My Profile</h2></div>
				<div class="heading">
					<cc-name class="heading_text" id="dynamic_name"></cc-name>
					<button class="heading_icon" onclick="logout();"><i class="material-icons">power_settings_new</i></button>
				</div>
			</div>
		</header>

		<cc-navbar id="navbar">
			<div class="blocker" id="blocker"></div>
			<div class="main">
				<div class="nohover item">
					<h1>Cart Chart</h1>
				</div>

				<a onclick="controller.page.goto('home')">
					<i class="material-icons">home</i>
					<span>Home</span>
				</a>
				<a onclick="controller.page.goto('admin')" id="adminlink">
					<i class="material-icons">description</i>
					<span>Admin</span>
				</a>
				<div class="group" id="group_location">
					<button>
						<div>
							<i class="material-icons">calendar_today</i>
							<span>Schedules</span>
							<i class="material-icons">chevron_left</i>
						</div>
					</button>
				</div>

				<div class="item">
					<button onclick="navbar.toggle();">
						<!-- <i class="fas fa-chevron-left"></i> -->
						<i class="material-icons contract_navbar">chevron_left</i>
					</button>
				</div>

			</div>
		</cc-navbar>

		<div class="main_container profile_page">
			<div class="main_center">
				<div class="profile info">
					<p>Your Information</p>
					<div>
						<cc-input form-id="profile_info" fb-update="firstName" fill="firstname" type="text" hint="First Name"></cc-input>
						<cc-input form-id="profile_info" fb-update="lastName" fill="lastname" type="text" hint="Last Name"></cc-input>
						<cc-input form-id="profile_info" fb-update="phoneNumber" fill="phonenumber" type="phone" hint="Phone Number"></cc-input form-id="profile_info">
						<cc-input disabled fill="email" type="email" hint="Email Address"></cc-input form-id="profile_info">
						<!-- <button onclick="myfun();">Send test email</button> -->
					</div>
				</div>

				<!-- <div class="profile shifts">
					<p>Shift Preferences</p>
				</div> -->

				<div class="profile settings">
					<p>App Preferences</p>
				</div>
			</div>
		</div>
		
		<cc-fab-bar>
			<cc-fab disabled colored id="save_changes" label="Save Changes" icon="save"></cc-fab-hint>
		</cc-fab-bar>

		<footer>
			<p>Cart Chart &copy;2020</p>
		</footer>

    <!-- Scripts -->
		<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-analytics.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-auth.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-database.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="js/controller.js"></script>
		<script src="js/main.js"></script>
		<script src="js/auth.js"></script>
		<script src="js/navbar.js"></script>
		<script src="js/custom_elements.js"></script>
		<script>
			var icon_compact = document.getElementById("compact"),
			schedule = false;

			navbar.element = document.getElementById('navbar');

			var profile = document.getElementsByClassName("profile_container")[0];
			function toggleModal() {
				$(profile).toggleClass("hide");
			}
			window.onclick = function(event) {
				var hide = true,
						button = document.getElementById("toggle_modal");
				for (i=0; i<event.path.length; i++) {
					if (event.path[i] == profile) {
						hide = false;
					} else if (event.path[i] == button) {
						hide = false;
					}
				}
				if (hide) {
					$(profile).addClass("hide");
				}
			}

			function forward() {
				all.changeDate(date.year, (date.month+1), date.day);
			}
			function backward() {
				all.changeDate(date.year, (date.month-1), date.day);
			}

			// document.querySelectorAll("cc-input[fb-update]").forEach(function(input) {
			// 	input.addEventListener('input', custom_input.changed);
			// });

			/*
			const submitEvent = (function() {
				this.inputs.forEach(function(input) {
					if (input.hasAttribute('fb-update')) {
						cUser[input.getAttribute('fb-update')] = input.getInputValue();
					}
				});
				cUser.updateInfo();
				this.checkForChanges();
			});

			let profile_form = new Form('profile_info', document.getElementById('save_changes'));
			profile_form.submissionEvent = submitEvent.bind(profile_form);
			*/

			async function myfun() {
				const res = await fetch('https://j4z7fif0wg.execute-api.us-east-1.amazonaws.com/default/send-email', {
					headers: {
						'x-api-key': 'm0lgJYWaui4YPNObIGuyzaF9ZOgkuXon27uDckBU',
						'content-type': 'application/json',
						'accept': 'application/json'
					},
					method: 'POST',
					body: JSON.stringify({
						addresses: ['thecartchart@gmail.com'],
						subject: 'Test Email',
						message: {
							template: 0,
							data: {
								name: {
									prefix: 'Brother',
									first: 'Robert',
									last: 'Impellitteri'
								},
								location: {
									town: 'Wakefield',
									state: 'RI'
								}
							}
						}
					})
				});

				const data = await res.json();
				console.dir(data);
			}

			// const makeBoundForm = (id, submitEl) => {
			// 	const form = new Form(id, submitEl);
			// 	form.addEvent = (eventName, func) => {
			// 		form[eventName] = () => func(form);
			// 		return form;
			// 	};
			// 	return form;
			// };
			
			// makeBoundForm('profile_info', document.getElementById('save_changes'))
			// 	.addEvent('submissionEvent', form => {
			// 		form.inputs.forEach(input => {
			// 			if (input.hasAttribute('fb-update')) {
			// 				cUser[input.getAttribute('fb-update')] = input.getInputValue();
			// 			}
			// 		});
			// 		cUser.updateInfo();
			// 		form.checkForChanges();
			// 	});

			window.addEventListener('loggedin', () => {
				profile_form = new Form('profile_info', document.getElementById('save_changes'));
				profile_form.submissionEvent = function() {
					this.inputs.forEach(input => {
						if (input.hasAttribute('fb-update')) {
							cUser[input.getAttribute('fb-update')] = input.getInputValue();
						}
					});
					cUser.updateInfo();
					this.checkForChanges();
				}
				profile_form.addInputValidation(document.querySelector('cc-input[fb-update="firstName"]'), function(value) {
					return {
						require: [
							value.length > 0,
							/(^[a-z]+(-| )?[a-z]+$)/gi.test(value) || value.length == 0
						],
						messages: [
							'is required',
							'must only use [a-z, -, space] and must be formated correctly'
						]
					};
				});
				profile_form.addInputValidation(document.querySelector('cc-input[fb-update="lastName"]'), function(value) {
					return {
						require: [
							value.length > 0,
							/(^[a-z]+(-| )?[a-z]+$)/gi.test(value) || value.length == 0
						],
						messages: [
							'is required',
							'must only use [a-z, -, space] and must be formated correctly'
						]
					};
				});
				profile_form.addInputValidation(document.querySelector('cc-input[fb-update="phoneNumber"]'), function(value) {
					return {
						require: [
							/\+?(\d{1,3})?.*(\d{3}).*(\d{3}).*(\d{4})/gi.test(value) || value.length == 0
						],
						repair: () => {
							if (value.match(/\+?(\d{1,3})?.*(\d{3}).*(\d{3}).*(\d{4})/g)) {
								let [number, country, area, town, last] = /\+?(\d{1,3})?[^\d]*(\d{3})[^\d]*(\d{3})[^\d]*(\d{4})/g.exec(value);
								return `+${country || 1} (${area})-${town}-${last}`;
							}
						},
						messages: [
							'must only use [0-9] and must be formated like xxx-xxx-xxxx'
						]
					};
				});
				delete profile_form;
			});

			document.querySelector('div.profile.settings').appendChild(FormBuilder([
				['select', {hint: 'App Theme', write: 'darkmode', onselection: 'toggleDarkMode(text);', category: true, default: 3, options: [
					{name: 'Constant', children: {text: ['Light', 'Dark'], value: [0, 1]}},
					{name: 'Dynamic', children: {text: ['Time Of Day', 'Device Theme'], value: [2, 3]}}
				]}]
			], {padding: '20px'}));

			// document.querySelector('div.profile.shifts').appendChild(FormBuilder([
			// 	['select', {hint: 'Week Days', checkbox: true, options: [
			// 		'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'
			// 	]}],
			// 	['select', {hint: 'Shift Times', category: true, checkbox: true, options: [
			// 		{name: 'Standard', children: {text: ['8AM - 10AM', '10AM - 12PM', '12PM - 2PM', '2PM - 4PM'], value: [0, 1, 2, 3]}},
			// 		{name: 'Winter', children: {text: ['10AM - 11:30AM', '11:30AM - 1PM', '1PM - 2:30PM'], value: [4, 5]}}
			// 	]}]
			// ], {padding: '20px'}));

		</script>
  </body>
</html>
