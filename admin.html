<!DOCTYPE html>
<html>
	<head>
		<title>Admin Tools | Cart Chart</title>
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,800&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,900&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link href="css/fonts/FontAwesome/css/all.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/main.css">
		<link rel="stylesheet" type="text/css" href="css/icons.css">
		<link rel="stylesheet" type="text/css" href="css/navbar.css">
		<link rel="stylesheet" type="text/css" href="css/loader.css">
		<link rel="stylesheet" type="text/css" href="css/controller.css">
		<link rel="stylesheet" type="text/css" href="css/invite.css">
		<link rel="stylesheet" type="text/css" href="css/user_editor.css">
		<link rel="stylesheet" type="text/css" href="css/custom_elements.css">
		<link rel="icon" type="image/png" href="favicons/favicon-192x192.png" sizes="192x192">
		<link rel="icon" type="image/png" href="favicons/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="16x16">
		<link rel="icon" type="image/png" href="favicons/favicon-128.png" sizes="128x128">
		<link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png">
		<link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-touch-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="144x144" href="favicons/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-touch-icon-57x57.png">
		<link rel="manifest" href="z_manifest.json">
		<meta name="theme-color" content="#ee9102"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>

	<body>
		<cc-page-loader><cc-circle></cc-circle></cc-page-loader>

		<header>
			<div class="navbar">
				<div class="title_container"><button class="title_bars" onclick="navbar.toggle();"><i class="material-icons">menu</i></button><h2 class="title">Admin Tools</h2></div>
				<div class="heading">
					<cc-name class="heading_text" id="dynamic_name"></cc-name>
					<button class="heading_icon" onclick="controller.page.goto('profile')"><i class="material-icons">settings</i></button>
					<button class="heading_icon" onclick="logout();"><i class="material-icons">power_settings_new</i></button>
					<button class="heading_icon" id="toggle_modal" onclick="toggleModal();"><i class="material-icons">person</i></button>
				</div>
			</div>
		</header>

		<cc-model class="profile">
			<div class="profile_container hide">
				<div>
					<cc-name></cc-name>
					<cc-email></cc-email>
					<a href="javascript:changePage('profile')">Manage Your Account</a>
					<a href="javascript:logout();">Sign Out</a>
				</div>
			</div>
		</cc-model>

		<cc-navbar id="navbar">
			<div class="blocker" id="blocker"></div>
			<div class="main">
				<div class="nohover item">
					<h1>Cart Chart</h1>
				</div>

				<a onclick="controller.page.goto('home')">
					<i class="material-icons">home</i>
					<span>Home</span>
				</a>
				<a onclick="controller.page.goto('admin')" id="adminlink">
					<i class="material-icons">description</i>
					<span>Admin</span>
				</a>
				<div class="group" id="group_location">
					<button>
						<div>
							<i class="material-icons">calendar_today</i>
							<span>Schedules</span>
							<i class="material-icons">chevron_left</i>
						</div>
					</button>
				</div>

				<div class="item">
					<button onclick="navbar.toggle();">
						<!-- <i class="fas fa-chevron-left"></i> -->
						<i class="material-icons contract_navbar">chevron_left</i>
					</button>
				</div>

			</div>
		</cc-navbar>

		<div class="main_container">
			<div class="form">
				<h2 class="title">Invite a new user</h2>
				<div class="form_item"><div class="form_item_group"><span class="form_item_extra"><span class="icon_profile"></span></span><input class="form_item" type="text" name="first_name" id="first_name" placeholder="First Name"></div></div>
				<div class="form_item"><div class="form_item_group"><span class="form_item_extra"><span class="arrow_carrot-right"></span></span><input class="form_item" type="text" name="last_name" id="last_name" placeholder="Last Name"></div></div>
				<div class="form_item"><div class="form_item_group"><span class="form_item_extra"><span class="icon_mail"></span></span><input class="form_item" type="email" name="email" id="email" placeholder="Email"></div></div>
				<div class="form_item"><div class="form_item_group submit_group"><button class="submit" onclick="create_user();">Invite</button></div></div>
				<div class="align_center"><span class="error_message" id="error_text"></span></div>

				<!-- <cc-input form-id="invite_user" type="text" hint="First Name"></cc-input>
				<cc-input form-id="invite_user" type="text" hint="Last Name"></cc-input>
				<cc-input form-id="invite_user" type="text" hint="Email"></cc-input> -->
			</div>

			<div class="form double">
				<h2 class="title">
					<cc-user-text default="Find a user" edit-name="A">
						<i class="material-icons">chevron_left</i>
					</cc-user-text>
					<input type="text" id="search" placeholder="Search" onchange="users.search(this.value)">
				</h2>
				<cc-user-editor>
					<cc-users></cc-users>
					<cc-users-edit>
						<p>User Editor</p>
					</cc-users-edit>
				</cc-user-editor>
			</div>
		</div>

		<!-- Firebase Scripts -->
		<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-analytics.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-auth.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-database.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="js/main.js"></script>
		<script src="js/admin/auth.js"></script>
		<script src="js/navbar.js"></script>
		<script src="js/controller.js"></script>
		<script src="js/inputs.js"></script>
		<script src="js/get_users.js"></script>
		<script src="js/custom_elements.js"></script>

		<!-- General Scripts -->
		<script>
			users.getAll();

			navbar.element = document.getElementById('navbar');

			var profile = document.getElementsByClassName("profile_container")[0];
			function toggleModal() {
				$(profile).toggleClass("hide");
			}
			window.onclick = function(event) {
				var hide = true,
						button = document.getElementById("toggle_modal");
				for (i=0; i<event.path.length; i++) {
					if (event.path[i] == profile) {
						hide = false;
					} else if (event.path[i] == button) {
						hide = false;
					}
				}
				if (hide) {
					$(profile).addClass("hide");
				}
			}

			async function create_user() {
				var email_input = document.getElementById("email");
				var email = email_input.value;
				var password = "{emptypassword}";
					var first_name_value = document.getElementById("first_name").value;
					var last_name_value = document.getElementById("last_name").value;
					secondaryApp.auth().createUserWithEmailAndPassword(email, password).then(function(firebaseUser) {
						var user = secondaryApp.auth().currentUser;
						var uid = user.uid;
						firebase.database().ref('users/' + uid).set({
							firstname: first_name_value,
							lastname: last_name_value,
							location: cUser.location,
							email: email
						});
						secondaryApp.auth().signOut();
						setSuccess("Sending email to: " + first_name_value + " " + last_name_value);
						emailUser();

						async function emailUser() {
							let data = await sendEmail('Invitation to join the Cart Chart.', [email], 0, {
								name: {
									prefix: 'Brother/Sister',
									first: first_name_value,
									last: last_name_value
								},
								location: {
									town: toTitleCase(cUser.location.slice(3)),
									state: cUser.location.slice(0,2).toUpperCase()
								}
							});

							if (data.success) setSuccess("Sucsessfully sent email"); else setError('Could\'nt send email: '+data.message);
						}
				}).catch(function(error) {
				if (error.code == "auth/invalid-email") {
					setError("Please enter a valid email address");
				} else if (error.code == "auth/email-already-in-use") {
					setError("That user has already been invited");
				}
				});
			}
		</script>
	</body>
</html>
